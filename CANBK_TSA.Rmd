---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
# # Required Packages
packages = c('quantmod','car','forecast','tseries','FinTS', 'rugarch','utf8','ggplot2')
# 
# # Install all Packages with Dependencies
# install.packages(packages, dependencies = TRUE)
# 
# # Load all Packages
lapply(packages, require, character.only = TRUE)

##
# 0.1. Fetch Single Stock/Index Data
getSymbols(Symbols = 'CANBK.NS', 
           src = 'yahoo', 
           from = as.Date('2018-01-01'), 
           to = as.Date('2023-12-31'),
           periodicity = 'daily')

stock_price = na.omit(CANBK.NS$CANBK.NS.Adjusted) # Adjusted Closing Price
class(stock_price) # xts (Time-Series) Object

stock_ret = na.omit(diff(log(stock_price))) # Stock Returns
plot(stock_price)
plot(stock_ret)
```
Analysis:

Objective: To analyze the daily returns of CANBK.NS stock from 2018-01-01 to 2023-12-31.

Analysis: Extracted the adjusted closing prices of CANBK.NS stock, calculated daily returns, and visualized them.

Result:
The 'CANBK.NS_return' plot displays the daily returns of CANBK.NS stock over the specified period.

Implication: 
The plot indicates the volatility and direction of daily returns for CANBK.NS stock during the given timeframe.
Observations from the plot can help investors understand the historical performance and risk associated with CANBK.NS stock.

```{r}
# Augmented Dickey-Fuller (ADF) Test for Stationarity with Stock Data

adf_test_stk_price = adf.test(stock_price); adf_test_stk_price  # Inference : Stock price Time-Series is Non-Stationary

adf_test_stk_ret = adf.test(stock_ret); adf_test_stk_ret # Inference : Stock Difference Time-Series is Stationary
```
Analysis:

Objective: To conduct an Augmented Dickey-Fuller (ADF) test for stationarity on the daily returns of CANBK.NS stock.

Analysis: Performed the ADF test using the 'adf.test' function and obtained results.

Result:
- For the stock price time series, the Dickey-Fuller statistic is -1.1123 with a p-value of 0.9206. Given the high p-value (greater than the typical significance level of 0.05), we fail to reject the null hypothesis, suggesting that the stock price time series is non-stationary.
- For the stock return time series, the Dickey-Fuller statistic is -10.017 with a p-value of 0.01. The low p-value (less than the typical significance level of 0.05) indicates that we can reject the null hypothesis, suggesting that the stock return time series is stationary.

Implication: The analysis reveals distinct characteristics of the stock price and stock return time series. The non-stationarity of the stock price time series implies that it has time-dependent structures such as trends or varying volatility, which are common in financial time series data. In contrast, the stationarity of the stock return time series suggests that its statistical properties do not change over time, making it more suitable for certain statistical modeling and forecasting techniques. Understanding the stationarity of financial time series is crucial for selecting appropriate models for analysis and forecasting in financial market studies.

```{r}
# Ljung-Box Test for Autocorrelation - Stock Data
# ***********************************************

lb_test_stk_ret = Box.test(stock_ret); lb_test_stk_ret # Inference : Stock Difference (Stationary) Time-Series is Autocorrelated

```

Analysis:

Objective: To perform a Ljung-Box test for autocorrelation on the daily returns of NESTLEIND.NS stock.

Analysis: Conducted the Ljung-Box test using the 'Box.test' function and obtained results.

Result:
The Ljung-Box test for autocorrelation on CANBK.NS daily returns yields the following results:
  - X-squared statistic: 2.7664e-05
  - Degrees of freedom: 1
  - p-value: 0.9958

Implication:
The Ljung-Box test indicates significant autocorrelation in the CANBK.NS stock daily returns. The p-value is large (0.9958).Given the high p-value (greater than the typical significance level of 0.05), there is insufficient evidence to reject the null hypothesis, which suggests that the stock return time series does not exhibit significant autocorrelation at lag 1.

Implication: The lack of significant autocorrelation in the stationary stock return time series implies that past returns are not a reliable predictor of future returns at the first lag. This characteristic is consistent with the Efficient Market Hypothesis (EMH), which posits that asset prices fully reflect all available information, making it difficult to achieve consistently higher returns than the market average. For traders and analysts, this result suggests that simple predictive models based on past returns may not be effective for forecasting future returns of this stock at the first lag. However, it's important to consider autocorrelation at other lags or incorporate additional variables or more sophisticated models for a comprehensive analysis.

```{r}
# Autocorrelation Function (ACF) | Partial Autocorrelation Function (PACF)
# *****************************************************************************

acf(stock_price) # ACF of Stock Price
pacf(stock_price) # PACF of Stock Price

acf(stock_ret) # ACF of Stock Return (Stationary) Series
pacf(stock_ret) # PACF of Stock Return (Stationary) Series
```
```{r}
# Auto ARIMA
arma_pq_stk_ret = auto.arima(stock_ret); arma_pq_stk_ret
arma_pq_stk = auto.arima(stock_price); arma_pq_stk
```
Objective: To identify an optimal autoregressive integrated moving average (ARIMA) model for the stock return time series.

Analysis: The auto.arima function was utilized to automatically select the best fitting ARIMA model for the stock return time series. This function iteratively explores various combinations of AR (autoregression), I (integration), and MA (moving average) components to find the model that best captures the time series data according to information criteria such as the Akaike Information Criterion (AIC), the corrected AIC (AICc), and the Bayesian Information Criterion (BIC).

Result:
- The auto.arima function identified an ARIMA(0,0,0) model with zero mean as the best fit for the stock return time series. This model, also known as a white noise model, indicates that there are no AR or MA components required to model the data effectively. The model parameters are as follows:
    - sigma^2 (variance of the model's errors) = 0.001149
    - Log likelihood = 2907.32
    - AIC = -5810.63
    - AICc = -5810.62
    - BIC = -5800.03

Implication: The selection of an ARIMA(0,0,0) model with zero mean suggests that the stock return time series behaves as a random walk or white noise process, where future values cannot be predictably determined from past values. This outcome reinforces the notion of market efficiency within the context of the analyzed data, indicating that the stock returns do not exhibit autocorrelations or patterns that could be exploited for predictive purposes. For financial analysts and investors, this model implies that traditional time series forecasting techniques may not be effective in predicting future returns of this stock, highlighting the importance of considering other factors or employing different strategies for investment decision-making.

Arima 2
Objective: To determine the most suitable ARIMA model for the stock price time series.

Analysis: The auto.arima function, a tool designed to automatically identify the best ARIMA model, was applied to the stock price time series. This function assesses various combinations of the AR (autoregression), I (integration), and MA (moving average) parameters to select a model that optimally fits the data based on specific criteria, such as the Akaike Information Criterion (AIC), the corrected Akaike Information Criterion (AICc), and the Bayesian Information Criterion (BIC).

Result:
- The optimal ARIMA model identified for the stock price time series is an ARIMA(0,1,0). This model does not include any autoregressive (AR) or moving average (MA) components but indicates that differencing the data once (I=1) renders it stationary. The model parameters are detailed as follows:
    - sigma^2 (the variance of the model's errors) = 49.67
    - Log likelihood = -4909.86
    - AIC = 9823.72
    - AICc = 9823.073
    - BIC = 9834.32

Implication: The selection of an ARIMA(0,1,0) model suggests that the stock price series is a random walk with no predictable pattern in its fluctuations when differenced once. This characteristic is common in financial time series, supporting the hypothesis that stock prices follow a random walk and thus, their future prices are not directly predictable based on past values alone. For market participants, this finding underscores the challenge of forecasting future stock prices using historical price data alone and highlights the importance of incorporating a broader range of market analysis, financial indicators, and possibly, external economic factors for effective investment strategies.


```{r}
# Ljung-Box Test for Autocorrelation - Model Residuals
# ****************************************************
lb_test_arma_pq_stk_ret = Box.test(arma_pq_stk_ret$residuals); lb_test_arma_pq_stk_ret

# Forecasting with ARIMA Models
# ************************************
# jj_ds_f11 = predict(arma11, n.ahead = 40)
# plot(jj_ds_f11)
# lines(jj_ds_f11$pred, col = 'blue')
# lines(jj_ds_f11$pred + 2 * jj_ds_f11$se, col = 'red')
# lines(jj_ds_f11$pred - 2 * jj_ds_f11$se, col = 'red')

stock_ret_fpq = forecast(arma_pq_stk_ret, h = 40)
plot(stock_ret_fpq)

stock_fpq = forecast(arma_pq_stk, h = 40)
plot(stock_fpq)
```
```{r}
# Test for Volatility Clustering or Heteroskedasticity: Box Test 
stk_ret_sq = arma_pq_stk_ret$residuals^2 # Return Variance (Since Mean Returns is approx. 0)
plot(stk_ret_sq)
stk_ret_sq_box_test = Box.test(stk_ret_sq, lag = 10) # H0: Return Variance Series is Not Serially Correlated
stk_ret_sq_box_test # Inference : Return Variance Series is Heteroskedastic (Has Volatility Clustering)

# Test for Volatility Clustering or Heteroskedasticity: ARCH Test
stk_ret_arch_test = ArchTest(arma_pq_stk_ret$residuals, lags = 10) # H0: No ARCH Effects
stk_ret_arch_test # Inference : Return Series is Heteroskedastic (Has Volatility Clustering)
```
```{r}
# GARCH Model
garch_model1 = ugarchspec(variance.model = list(model = 'sGARCH', garchOrder = c(1,1)), mean.model = list(armaOrder = c(0,0), include.mean = TRUE))
nse_ret_garch1 = ugarchfit(garch_model1, data = arma_pq_stk_ret$residuals); nse_ret_garch1

garch_model2 = ugarchspec(variance.model = list(model = 'sGARCH', garchOrder = c(1,1)), mean.model = list(armaOrder = c(4,5), include.mean = FALSE))
nse_ret_garch2 = ugarchfit(garch_model2, data = arma_pq_stk_ret$residuals); nse_ret_garch2

# Test for Volatility Clustering or Heteroskedasticity: ARCH Test
gar_resd = residuals(nse_ret_garch2)^2
stk_ret_arch_test1 = ArchTest(gar_resd, lags = 1) # H0: No ARCH Effects
stk_ret_arch_test1 # Inference : Return Series is Heteroskedastic (Has Volatility Clustering)
```
```{r}
garch_modelf = ugarchspec(variance.model = list(model = 'sGARCH', garchOrder = c(1,1)), mean.model = list(armaOrder = c(4,5), include.mean = FALSE))
stk_ret_garch = ugarchfit(garch_modelf, data = stock_ret); stk_ret_garch
```
```{r}
# GARCH Forecast
stk_ret_garch_forecast1 = ugarchforecast(stk_ret_garch, n.ahead = 50); stk_ret_garch_forecast1
plot(stk_ret_garch_forecast1)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

